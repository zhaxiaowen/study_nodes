# 发版问题

#### 凌晨发版

#### 问题现象

1. oa服务jenkins发包失败，原因是ansible上传包解压命令失败
2. fileexportimpl连接数据库异常
3. 测试反馈oa前端代码未生效
4. 测试验证时反馈程序异常，日志显示RPC请求失败
5. nginx任务下成功，但配置未下发成功

#### 问题原因

1. nginx配置未下发成功：/etc/ansible/hosts文件里没有配nginx服务器的ip,导致未成功下发，报`No hosts matched, nothing to do`

2. fileexportimpl连接数据库异常：连接oa库异常，oa已从腾讯云迁移到华为云，apollo的oa库地址未及时修改，修改后正常

3. oa问题：

   * 目标服务器python问题，导致下发ansible命令失败

   * 手动上传包到服务器上部署，坑来了，因为oa前几天迁移到华为云了，但是并未用jenkins部署，所以jenkins上显示上次部署成功的ip还是腾讯云的，结果手动部署到旧的服务器上了，结果就是测试反馈代码好像未生效，后来发现后重新部署到华为云服务器，并停掉腾讯云上的服务
   * 程序异常原因：旧的腾讯云的应用未停，部分应用连接的还是腾讯云的应用，结果报程序异常，重启服务后正常

#### 总结

坑：

* oa旧的应用未停，从腾讯云迁移到华为云已经接近1周，还有服务连的腾讯云的服务，这个未能及时发现
* 部署oa应用未用jenkins，导致发版时才发现jenkins部署失败
* 不够细心，没有从jenkins日志去拿应用ip，而是从上次发布成功的那里拿的ip，导致部署到腾讯云，无效操作
* 程序异常时，排查不够细心，没有留意到是连接腾讯云的ip，浪费了比较多时间 ，而且排查方向一直错误，以为是nginx配置问题





### 发版遇到的很多无效问题,浪费时间

1. 发版过程中部分服务告警屏蔽未生效,导致大批告警:原因:运开告警静默选的项目名而不是服务名
2. jenkins日志不明确,有些错误没有错误日志,导致判断不出哪里的问题,只能手动传包
3. 服务器初始化问题,新增服务申请的服务器与以前的不一致,导致添加告警时,没有node_exporter组件
