# Kafka堆积

**案例1：**

**故障现象：**

1.kafka消费堆积，消费组成员数量一直变化，一直有实例离开、加入消费组，触发rebalance

2.10个分区，只消费1个分区，其他分区不消费

**腾讯云专家给出的建议：**

1.修改records参数

2.消费组的实例数量减少到1，看下是否有改善

3.重启有问题的节点

**故障处理：**

1.broker正常，该topic其他消费组都正常

2.修改max.poll.interval.ms心跳上报时间，调长

3.修改max.poll.records批处理的条数，调小，调成100；如果在心跳上报时间内批量处理的条数没有处理完成，kafka会任务客户端不行，会触发rebalance,并重复消费

4.重启所有节点，没有再出现rebalance,恢复正常消费

**故障原因：**可能是部分应用有问题导致



案例2：

故障现象：kafka堆积

故障原因：

1.直接原因：启动灾备节点触发rebalance groupid,消费组被分配到灾备节点，灾备节点消费速度慢导致堆积

2.根本原因：该topic为保证顺序消费，为单分区，消费者只有1个线程可以消费，同时线程需要处理多次远程调用业务逻辑，灾备节点网络延迟2.5ms放大调用处理时间

处理方法：

1.下掉灾备节点流量

2.因为无法增加消费者，所以对消费者服务器做升配处理，升配后，消费能力有所提高，等待消费完成

影响：影响货物分拣效率，影响货物时效

原因：灾备节点启动，kafka消费者实例增加触发重平衡，灾备消费能力弱导致堆积



kafka topic消息堆积

影响：暂未收到业务方反馈异常，目前消息堆积数280w+，具体影响待评估

原因：通过调整业务线配置参数的批处理条数，由1000减少到100，重启服务后恢复。

